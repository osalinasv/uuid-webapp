---
import { v4 as uuidv4 } from 'uuid'
import { formatPageTitle } from '@/lib/utils'
import { sanitizeIdInput } from '@/lib/uuid/shared'

import ConvertResult from '@/components/converter/ConvertResult.astro'

const id = Astro.url.searchParams.get('id')
let rawValue = sanitizeIdInput(id)

if (!rawValue) {
  rawValue = uuidv4()

  const events = { 'sv:generated': { id: rawValue } }
  Astro.response.headers.append('HX-Trigger', JSON.stringify(events))
}

Astro.response.headers.append('HX-Push-Url', `/${encodeURIComponent(rawValue)}`)
---

<head><title>{formatPageTitle(rawValue)}</title></head>
<ConvertResult rawValue={rawValue} />
