---
import { type HTMLAttributes } from 'astro/types'
import { cn } from '@/lib/utils'

export type Props = HTMLAttributes<'div'> & { id: string }
const { class: classNames, id, ...props } = Astro.props as Props
---

<div
  data-focused="false"
  class={cn('inline-block', classNames)}
  {...props}
  _={`on mouseenter or focusin
      set @data-focused to true

      measure me then set container to it
      measure #${id} then set tooltip to it
      set #${id}[@style] to \`left:\${(container.left + (container.width/2)) - (tooltip.width/2)}px;top:\${(container.bottom - container.height) - tooltip.height}px;\`

      wait 500ms
      if @data-focused is 'true' then
        set #${id}[@data-state] to 'open'
      end

      on mouseleave or focusout
      set @data-focused to false
      if #${id}[@data-state] is 'open' then
        set #${id}[@data-state] to 'closing'
      else
        set #${id}[@data-state] to 'closed'
      end`}>
  <slot />

  <div
    id={id}
    role="tooltip"
    data-state="closed"
    class="group fixed z-50 overflow-hidden pb-1 data-[state=closing]:pointer-events-none data-[state=closed]:invisible"
    _='on animationend if @data-state is "closing" then set @data-state to "closed" end'>
    <div
      class="min-w-max rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground group-data-[state=open]:animate-in group-data-[state=closing]:animate-out group-data-[state=closing]:fade-out-0 group-data-[state=open]:fade-in-0 group-data-[state=closing]:zoom-out-95 group-data-[state=open]:zoom-in-95 group-data-[state=open]:slide-in-from-bottom-2">
      <slot name="tooltip" />
    </div>
  </div>
</div>
